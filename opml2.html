<html><head><title>live list editor</title>
<style type="text/css">
.item_text {
    background: #ccc;
}
.item {
    background: #cfc;
    padding-left: 1em;
    padding-right: 1em;
}
.selected {
    border: 1px solid red;
}
</style>
<script lang="text/javascript">


//////////////////////////////////////////////////////////////////////////////
// manipulating items

function remove_item(item) {
    var pa = item.parentNode;
    pa.removeChild(item);
    debug("remove_item");
}

function newitem(text) {
    var li = document.createElement("li");
    var a = document.createElement("a");
    a.href = '#';
    a.appendChild(document.createTextNode("x"));
    a.addEventListener("click", function () {
        remove_item(li);
    }, false);
    li.appendChild(document.createTextNode(text + ' '));
    li.appendChild(a);
    li.addEventListener("click", function() {
        if(li.parentNode) {
            if(item_is_selected(li)) {
                edit_item_text(li);
            } else {
                select_item(li);
            }
        }
    }, false);
    li.setAttribute("class", "item");
    return li;
}

function edit_item_text(item) {
    var text = prompt("item text", "item text goes here");
    var ni = newitem(text);
    item.parentNode.replaceChild(ni, item);
}

function additem(text) {
    var list = document.getElementById("mainlist");
    var item = newitem(text);
    list.appendChild(item);
    debug("new item added");
    select_item(item);
}

function deselect_all_items() {
    var list = document.getElementById("mainlist");
    for(var child = list.firstChild; null != child; child = child.nextSibling) {
        if(child.setAttribute) {
            child.setAttribute("class", "item");
        } // could be text node?
    }
}

function item_is_selected(item) {
    return "selected item" == item.getAttribute("class");
}

function select_item(item) {
    deselect_all_items();
    item.setAttribute("class", "selected item");
    debug("select_item");
}

//////////////////////////////////////////////////////////////////////////////
// global event hooks and functions

function additem_button() {
    additem("new item");
}

function list_startup() {
    additem("first item");
    debug("lift-off");
}

function debug(text) {
    debugarea = document.getElementById("debugarea");
    debugarea.value += '\n' + text;
    debugarea.scrollTop = debugarea.scrollHeight;
}

</script>

</head>
<body id="thebody" onload="list_startup()";>
<ul id="mainlist">
</ul>
<input type="submit" onclick="debugme();" value="debugme" />
<input type="submit" onclick="additem_button();" value="new item" />
<hr />
<textarea style="width:100%;" rows="20" id="debugarea"></textarea>

</body></html>
